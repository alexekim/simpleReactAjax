<link rel="stylesheet" href="/css/materialize.css" media="screen" title="no title" charset="utf-8">

<style media="screen">
  .eachBBCWrapper{
    display: inline-block;
  }
  .eachBBC {
    border: 1px solid #3a75c4;
    margin: 10px;
    padding: 10px;
    width: 260px;
    min-height: 150px;
  }
  .eachBBC:hover{
    box-shadow: 3px 3px;
  }
  .eachBBCLink>div:focus{
    box-shadow: 3px 3px;
  }




  @media (max-width: 1000px){
    .eachBBCWrapper{ width: 95%; }
    .eachBBC{ width: 95%; }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>

<div id="root"></div>

<script type="text/babel">
  class BbcContainer extends React.Component{
    constructor(props){
      super(props);
    }
    render(){
      return (
        <div className="bbcContainer">
          <h2>Better Breathers Clubs</h2>
          <BbcGuys />
        </div>
      )
    }
  }

  class BbcGuys extends React.Component {
    constructor(props) {
      super(props);
      let i = 0;
      this.state = {
        titles: [],
        links: [],
        cities: [],
        usStates: []
      };
      this.handleClick = this.handleClick.bind(this);
      this.componentDidMount = this.componentDidMount.bind(this);
    }
    handleClick(){
      console.log("log");
    }
    componentDidMount(){
      $.ajax({
        type: "GET",
        url: 'http://www.lung.org/dev/reading-position-indicator/bbc-feed.xml?related_state=IL',
        dataType: "xml",
        success: data => {
          console.log(data);
          let htmlCollectionAllBbc_Item = data.getElementsByTagName("bbc_item");
          htmlCollectionAllBbc_Item = [].slice.call(htmlCollectionAllBbc_Item);
          // htmlCollectionAllBbc_Item is now an array, not an htmlcollection
          let arrayOfCitiesAsStrings = htmlCollectionAllBbc_Item.map(cities => cities.getElementsByTagName("city")[0].innerHTML);
          let arrayOfLinksAsStrings = htmlCollectionAllBbc_Item.map(links => links.getElementsByTagName("link")[0].innerHTML);
          let arrayOfStatesAsStrings = htmlCollectionAllBbc_Item.map(states => states.getElementsByTagName("state")[0].innerHTML);

          let arrayOfTitlesAsStrings = htmlCollectionAllBbc_Item.map(titles => titles.getElementsByTagName("title")[0].innerHTML);
          let titlesClean = [];
          for (var i = 0; i < arrayOfTitlesAsStrings.length; i++) {
            var redoneTitle = arrayOfTitlesAsStrings[i].replace("<![CDATA[","").replace("]]>","");
            titlesClean.push(redoneTitle);
          }

          this.setState({titles: titlesClean, links: arrayOfLinksAsStrings, cities: arrayOfCitiesAsStrings, usStates: arrayOfStatesAsStrings});

          return data;
        },
        error: (err) => {
          throw err;
        }
      })
    }
    render(){
      const bothArrays = this.state.titles.map( (title, index, i) =>
         (
           <div  id={"bbc"+i} className="eachBBCWrapper" key={index}>
             <a className="eachBBCLink" href={this.state.links[index]}>
              <div className="eachBBC" >
                <p>{title}</p>
                <p>{this.state.cities[index]}, {this.state.usStates[index]}</p>
              </div>
            </a>
          </div>
        )
      );
      return (
        <div>
          {bothArrays}
        </div>
      );
    }
  }


  ReactDOM.render(<BbcContainer />, document.getElementById("root"));
</script>
