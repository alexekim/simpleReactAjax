<style media="screen">
  .bbcItem {
    display: inline-block;
    vertical-align: bottom;
    width: 28%;
    margin: 10px;
    padding: 10px;
    min-height: 83px;

    border: 1px solid #3a75c4;
    box-shadow: 5px;

  }
</style>


<!-- development -->
<script src="https://unpkg.com/vue"></script>
<!-- production -->
<!-- <script src="https://unpkg.com/vue@2.6.5/dist/vue.min.js"></script> -->

<p>
  bbc vue
</p>
<div id="app">
  <p>
    {{message}}
  </p>

  <div id="bbcContainer">
    <!-- <div  class="row"> -->
    <a v-for="bbc in bbcs" :href="bbc.link" :key="bbc.index">
      <div class="bbcItem" >
        {{bbc.index}} <br/>
        {{ bbc.title }} <br/>
        {{bbc.city}},&nbsp;{{ bbc.state }}
      </div>
    </a>
    <!-- </div> -->

  </div>



</div>

<script type="text/javascript">
  var all = [
    // {
    //   "title" : "Better whatever",
    //   "link": "https://www.lung.org",
    //   "city": "Chicago",
    //   "state": "Illinois"
    // }
  ]


  var ajaxCall = function() {
    return new Promise(function(resolve, reject) {
      app.message = "ajax working....!";
      all = [];
      app.bbcs = [];
      var currentState = Cookies.get("state");
      $.ajax({
        type: "GET",
        // url: 'vue.xml',
        url: "//www.lung.org/assets/reus/bbc-feed.xml?related_state=" + currentState,
        dataType: "xml",
        success: function(data) {
          console.log("DATA======================")
          console.log(data);
          console.log(data.domain)
          var htmlCollectionAllBbc_Item = data.getElementsByTagName("bbc_item");
          // console.log(htmlCollectionAllBbc_Item);
          htmlCollectionAllBbc_Item = [].slice.call(htmlCollectionAllBbc_Item);
          console.log("htmlCollectionAllBbc_Item===================");
          console.log(htmlCollectionAllBbc_Item);
          console.log("NUMBER=====================")
          console.log("htmlCollectionAllBbc_Item has " + htmlCollectionAllBbc_Item.length + " items");
          for (var i = 0; i < htmlCollectionAllBbc_Item.length; i++) {
            console.log("ITS HERE I KNOW LOOK AT THE LENGTH!!!!!!!");
            console.log(htmlCollectionAllBbc_Item[i]);
          }

          console.log("CAN WE FIND A city?");
          // console.log($(htmlCollectionAllBbc_Item).find("city")[0].textContent); // avoiding jquery call
          console.log(htmlCollectionAllBbc_Item[0].querySelector("city").textContent);  // works in all browsers
          // console.log( htmlCollectionAllBbc_Item[0].querySelector("city").innerHTML  );  // didnt work in IE
          console.log("CAN WE FIND A state?");
          console.log(htmlCollectionAllBbc_Item[0].getElementsByTagName('state')[0].innerHTML)
          console.log("CAN WE FIND A title?");
          console.log(htmlCollectionAllBbc_Item[0].getElementsByTagName('title')[0].innerHTML)
          console.log("CAN WE FIND A link?");
          console.log(htmlCollectionAllBbc_Item[0].getElementsByTagName('link')[0].innerHTML)


          // var arrayOfCitiesAsStrings = htmlCollectionAllBbc_Item.map(function(cities) {
          //   return cities.getElementsByTagName("city")[0].innerHTML;
          // });
          var arrayOfCitiesAsStrings = [];
          for (var i = 0; i < htmlCollectionAllBbc_Item.length; i++) {
            arrayOfCitiesAsStrings.push(htmlCollectionAllBbc_Item[i].querySelector("city").textContent);
          }
          console.log("DIRTY VERSIONS OF ARRAYS=======1");
          console.log(arrayOfCitiesAsStrings);

          // var arrayOfLinksAsStrings = htmlCollectionAllBbc_Item.map(function(links) {
          //   return links.getElementsByTagName("link")[0].innerHTML;
          // });
          var arrayOfLinksAsStrings = [];
          for (var i = 0; i < htmlCollectionAllBbc_Item.length; i++) {
            arrayOfLinksAsStrings.push(htmlCollectionAllBbc_Item[i].querySelector("link").textContent);
          }
          console.log("DIRTY VERSIONS OF ARRAYS=======2");
          console.log(arrayOfLinksAsStrings);

          // var arrayOfStatesAsStrings = htmlCollectionAllBbc_Item.map(function(states) {
          //   return states.getElementsByTagName("state")[0].innerHTML;
          // });
          var arrayOfStatesAsStrings = [];
          for (var i = 0; i < htmlCollectionAllBbc_Item.length; i++) {
            arrayOfStatesAsStrings.push(htmlCollectionAllBbc_Item[i].querySelector("state").textContent);
          }
          console.log("DIRTY VERSIONS OF ARRAYS=======3");
          console.log(arrayOfStatesAsStrings);

          // var arrayOfTitlesAsStrings = htmlCollectionAllBbc_Item.map(function(titles) {
          //   return titles.getElementsByTagName("title")[0].innerHTML;
          // });
          var arrayOfTitlesAsStrings = [];
          for (var i = 0; i < htmlCollectionAllBbc_Item.length; i++) {
            arrayOfTitlesAsStrings.push(htmlCollectionAllBbc_Item[i].querySelector("title").textContent);
          }
          console.log("DIRTY VERSIONS OF ARRAYS=======4");
          console.log(arrayOfTitlesAsStrings);






          var titlesClean = [];
          for (var i = 0; i < arrayOfTitlesAsStrings.length; i++) {
            var setIt = arrayOfTitlesAsStrings[i];
            console.log("SETIT========================1");
            console.log(setIt);
            // var redoneTitle = arrayOfTitlesAsStrings[i].replace("<![CDATA[", "").replace("]]>", "");
            var redoneTitle = setIt.replace("<![CDATA[", "").replace("]]>", "");
            titlesClean.push(redoneTitle);
          }
          var citiesClean = [];
          for (var i = 0; i < arrayOfCitiesAsStrings.length; i++) {
            var setIt = arrayOfCitiesAsStrings[i];
            console.log("SETIT========================2");
            console.log(setIt);
            // var redoneCity = arrayOfCitiesAsStrings[i].replace("<![CDATA[", "").replace("]]>", "");
            var redoneCity = setIt.replace("<![CDATA[", "").replace("]]>", "");
            citiesClean.push(redoneCity);
          }
          var statesClean = [];
          for (var i = 0; i < arrayOfStatesAsStrings.length; i++) {
            var setIt = arrayOfStatesAsStrings[i];
            console.log("SETIT========================3");
            console.log(setIt);
            // var redoneState = arrayOfStatesAsStrings[i].replace("<![CDATA[", "").replace("]]>", "");
            var redoneState = setIt.replace("<![CDATA[", "").replace("]]>", "");
            statesClean.push(redoneState);
          }
          var linksClean = [];
          for (var i = 0; i < arrayOfLinksAsStrings.length; i++) {
            var setIt = arrayOfLinksAsStrings[i];
            console.log("SETIT========================4");
            console.log(setIt);
            // var redoneLinks = arrayOfLinksAsStrings[i].replace("<![CDATA[", "").replace("]]>", "");
            var redoneLinks =setIt.replace("<![CDATA[", "").replace("]]>", "");
            linksClean.push(redoneLinks);
          }

          for (var i = 0; i < titlesClean.length; i++) {
            all.push({
              "title": titlesClean[i]
            });
            all[i].city = citiesClean[i];
            all[i].state = statesClean[i];
            all[i].link = linksClean[i];
            all[i].index = i+1;
          }
          console.log("---------");
          console.log(all);
          resolve("yep it's done?");

        },
        error: function(err) {
          console.warn(err);
          reject("didn't werk");
        }
      })
    })

  }

  var handleResolve = function(resolve) {
    console.log(resolve);
    app.message = "ajax done";
    app.bbcs = all;
    console.log("app: ");
    console.log(app);
  }
  var handleReject = function(reject) {
    throw reject;
  }

  var runIt = function(){
    ajaxCall()
      .then(handleResolve)
      .catch(handleReject)

  }

  $(document).ready(function() {
    runIt();
  })


  var app = new Vue({
    el: "#app",
    data: {
      message: "ajax working.....",
      bbcs: all
    },
    methods: {
      changeEmoji: function() {
        console.log(example);
      }
    }
  })


  $("[name='searchZip']").on("submit", function() {
    console.log("zip changed");

    setTimeout(runIt, 500);
    // $(".info").show();
  })
  $("#stateSelectList").on("change", function() {
    console.log(" select changed");

    runIt();
    // $(".info").show();
  })
</script>
